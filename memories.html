
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üì∑ Memories with You</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #D4E6C3 0%, #B5D4A3 50%, #9BC484 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 20px;
        }

        /* Floating decorations */
        .floating-deco {
            position: fixed;
            font-size: 2rem;
            opacity: 0.25;
            z-index: 0;
            animation: float-deco 6s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes float-deco {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        .floating-deco:nth-child(1) { top: 8%; left: 5%; animation-delay: 0s; }
        .floating-deco:nth-child(2) { top: 15%; right: 8%; animation-delay: 1s; }
        .floating-deco:nth-child(3) { bottom: 15%; left: 8%; animation-delay: 2s; }
        .floating-deco:nth-child(4) { bottom: 25%; right: 5%; animation-delay: 0.5s; }
        .floating-deco:nth-child(5) { top: 45%; left: 3%; animation-delay: 1.5s; }
        .floating-deco:nth-child(6) { top: 55%; right: 3%; animation-delay: 2.5s; }

        /* Sparkle container */
        .sparkle-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
            overflow: hidden;
        }

        .sparkle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 0 10px 2px rgba(255, 255, 255, 0.8);
            animation: sparkle-twinkle 2s infinite;
        }

        @keyframes sparkle-twinkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        /* Back button */
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            transition: all 0.3s;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .back-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .back-btn:active {
            transform: scale(0.95);
        }

        /* Music indicator */
        .music-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 25px;
            display: none;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: #2D5A27;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
            z-index: 100;
            cursor: pointer;
        }

        .music-indicator.show {
            display: flex;
        }

        .music-bars {
            display: flex;
            gap: 2px;
            align-items: flex-end;
            height: 15px;
        }

        .music-bar {
            width: 3px;
            background: #7BC89C;
            border-radius: 2px;
            animation: music-bar 0.5s infinite alternate;
        }

        .music-bar:nth-child(1) { height: 5px; animation-delay: 0s; }
        .music-bar:nth-child(2) { height: 10px; animation-delay: 0.1s; }
        .music-bar:nth-child(3) { height: 7px; animation-delay: 0.2s; }
        .music-bar:nth-child(4) { height: 12px; animation-delay: 0.3s; }

        @keyframes music-bar {
            to { height: 15px; }
        }

        .music-indicator.paused .music-bar {
            animation: none;
            height: 5px;
        }

        /* Title */
        .page-title {
            text-align: center;
            margin-bottom: 15px;
            z-index: 10;
            opacity: 0;
            animation: fadeDown 0.8s 0.3s forwards;
        }

        @keyframes fadeDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page-title h1 {
            font-size: 1.6rem;
            color: #2D5A27;
            font-weight: bold;
            text-shadow: 0 2px 10px rgba(255, 255, 255, 0.5);
        }

        .page-title .subtitle {
            font-size: 0.9rem;
            color: #5BA37A;
            margin-top: 5px;
        }

        /* Main gallery container */
        .gallery-wrapper {
            width: 100%;
            max-width: 400px;
            z-index: 10;
            opacity: 0;
            animation: scaleIn 0.6s 0.5s forwards;
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Polaroid frame */
        .polaroid-frame {
            background: #fff;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.25),
                0 0 0 1px rgba(0, 0, 0, 0.05);
            position: relative;
            transform: rotate(-2deg);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .polaroid-frame.tilt-left {
            transform: rotate(-4deg);
        }

        .polaroid-frame.tilt-right {
            transform: rotate(4deg);
        }

        .polaroid-frame::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 25px;
            background: linear-gradient(135deg, rgba(200, 180, 150, 0.6) 0%, rgba(180, 160, 130, 0.4) 100%);
            border-radius: 3px;
            z-index: 20;
        }

        /* Media container */
        .media-container {
            width: 100%;
            aspect-ratio: 4/5;
            background: #1a1a1a;
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .media-item {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #1a1a1a;
            opacity: 0;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .media-item.active {
            opacity: 1;
            z-index: 10;
        }

        .media-item.slide-left {
            animation: slideOutLeft 0.5s forwards;
        }

        .media-item.slide-right {
            animation: slideOutRight 0.5s forwards;
        }

        .media-item.slide-in-left {
            animation: slideInFromRight 0.5s forwards;
        }

        .media-item.slide-in-right {
            animation: slideInFromLeft 0.5s forwards;
        }

        @keyframes slideOutLeft {
            from { transform: translateX(0) scale(1); opacity: 1; }
            to { transform: translateX(-100%) scale(0.8); opacity: 0; }
        }

        @keyframes slideOutRight {
            from { transform: translateX(0) scale(1); opacity: 1; }
            to { transform: translateX(100%) scale(0.8); opacity: 0; }
        }

        @keyframes slideInFromRight {
            from { transform: translateX(100%) scale(0.8); opacity: 0; }
            to { transform: translateX(0) scale(1); opacity: 1; }
        }

        @keyframes slideInFromLeft {
            from { transform: translateX(-100%) scale(0.8); opacity: 0; }
            to { transform: translateX(0) scale(1); opacity: 1; }
        }

        /* Loading spinner */
        .loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top-color: #7BC89C;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            z-index: 5;
        }

        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .loading-spinner.hidden {
            display: none;
        }

        /* Heart decoration on polaroid */
        .heart-deco {
            position: absolute;
            bottom: 10px;
            right: 15px;
            font-size: 1.3rem;
            opacity: 0.6;
            animation: heartBeat 1.5s infinite;
        }

        .heart-deco-left {
            position: absolute;
            bottom: 10px;
            left: 15px;
            font-size: 1.3rem;
            opacity: 0.6;
            animation: heartBeat 1.5s infinite;
            animation-delay: 0.3s;
        }

        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Navigation controls */
        .nav-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
            z-index: 10;
        }

        .nav-btn {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #fff 0%, #f5f5f5 100%);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s;
            color: #2D5A27;
        }

        .nav-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        }

        .nav-btn:active {
            transform: scale(0.95);
        }

        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }

        .nav-btn.prev { padding-right: 4px; }
        .nav-btn.next { padding-left: 4px; }

        /* Counter */
        .counter {
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            color: #2D5A27;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
            min-width: 80px;
            text-align: center;
        }

        .counter .current {
            color: #5BA37A;
            font-size: 1.2rem;
        }

        /* Progress bar */
        .progress-bar {
            width: 100%;
            max-width: 400px;
            height: 4px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 2px;
            margin-top: 20px;
            overflow: hidden;
            z-index: 10;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #7BC89C 0%, #5BA37A 100%);
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        /* Thumbnail strip */
        .thumbnail-strip {
            display: flex;
            gap: 8px;
            margin-top: 20px;
            overflow-x: auto;
            padding: 10px 5px;
            max-width: 100%;
            z-index: 10;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .thumbnail-strip::-webkit-scrollbar {
            display: none;
        }

        .thumbnail {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
            background: #ddd;
            position: relative;
        }

        .thumbnail.active {
            border-color: #5BA37A;
            transform: scale(1.1);
            box-shadow: 0 3px 15px rgba(91, 163, 122, 0.4);
        }

        .thumbnail img,
        .thumbnail video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .thumbnail .video-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.9rem;
            color: #fff;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
            background: rgba(0,0,0,0.4);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Hearts burst effect */
        .hearts-burst {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 200;
            overflow: hidden;
        }

        .burst-heart {
            position: absolute;
            font-size: 1.5rem;
            opacity: 0;
        }

        .burst-heart.animate {
            animation: heartBurst 1.5s forwards ease-out;
        }

        @keyframes heartBurst {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(0);
            }
            50% {
                opacity: 1;
                transform: translate(var(--tx), var(--ty)) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translate(calc(var(--tx) * 1.5), calc(var(--ty) * 1.5)) scale(0.5);
            }
        }

        /* Swipe hint */
        .swipe-hint {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #5BA37A;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
            z-index: 50;
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
            animation: fadeInOut 4s 1s forwards;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            15% { opacity: 1; transform: translateX(-50%) translateY(0); }
            85% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-10px); display: none; }
        }

        .swipe-icon {
            animation: swipeHand 1s infinite;
        }

        @keyframes swipeHand {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(10px); }
        }

        /* Empty state */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 40px 20px;
            color: #5BA37A;
        }

        .empty-state .icon {
            font-size: 4rem;
            margin-bottom: 15px;
            opacity: 0.5;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .empty-state h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #2D5A27;
        }

        .empty-state p {
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.5;
        }

        /* Confetti burst */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 150;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            top: -20px;
            opacity: 0;
        }

        .confetti.fall {
            animation: confettiFall 3s forwards ease-out;
        }

        @keyframes confettiFall {
            0% { opacity: 1; top: -20px; transform: rotate(0deg) translateX(0); }
            100% { opacity: 0; top: 100vh; transform: rotate(720deg) translateX(100px); }
        }
    </style>
</head>
<body>
    <!-- Floating decorations -->
    <div class="floating-deco">üì∑</div>
    <div class="floating-deco">üíï</div>
    <div class="floating-deco">‚ú®</div>
    <div class="floating-deco">üå∏</div>
    <div class="floating-deco">üíñ</div>
    <div class="floating-deco">üéÄ</div>

    <!-- Sparkle container -->
    <div class="sparkle-container" id="sparkleContainer"></div>

    <!-- Hearts burst container -->
    <div class="hearts-burst" id="heartsBurst"></div>

    <!-- Confetti container -->
    <div class="confetti-container" id="confettiContainer"></div>

    <!-- Back button -->
    <button class="back-btn" onclick="goBack()">‚Üê</button>

    <!-- Music indicator -->
    <div class="music-indicator" id="musicIndicator">
        <div class="music-bars">
            <div class="music-bar"></div>
            <div class="music-bar"></div>
            <div class="music-bar"></div>
            <div class="music-bar"></div>
        </div>
        <span>Music Playing</span>
    </div>

    <!-- Title -->
    <div class="page-title">
        <h1>üì∑ Memories with You üíï</h1>
        <p class="subtitle">Our precious moments together</p>
    </div>

    <!-- Gallery wrapper -->
    <div class="gallery-wrapper">
        <div class="polaroid-frame" id="polaroidFrame">
            <div class="media-container" id="mediaContainer">
                <div class="loading-spinner" id="loadingSpinner"></div>
                <!-- Media items will be inserted here -->
            </div>
            <div class="heart-deco-left">üíï</div>
            <div class="heart-deco">üíñ</div>
        </div>
    </div>

    <!-- Navigation controls -->
    <div class="nav-controls">
        <button class="nav-btn prev" id="prevBtn" onclick="prevMedia()">‚óÄ</button>
        <div class="counter">
            <span class="current" id="currentNum">1</span>
            <span>/</span>
            <span id="totalNum">0</span>
        </div>
        <button class="nav-btn next" id="nextBtn" onclick="nextMedia()">‚ñ∂</button>
    </div>

    <!-- Progress bar -->
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <!-- Thumbnail strip -->
    <div class="thumbnail-strip" id="thumbnailStrip"></div>

    <!-- Swipe hint -->
    <div class="swipe-hint" id="swipeHint">
        <span class="swipe-icon">üëÜ</span>
        <span>Swipe or tap arrows to navigate</span>
    </div>

    <!-- Background music -->
    <audio id="bgMusic" loop>
        <source src="audio/Vienna.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ==================== CONFIGURATION ====================
        // List your media files here - just the filenames!
        // The script will automatically detect if it's an image or video
        // Put all your files in the 'memories' folder
        
        const mediaFiles = [
            'photo1.jpg',
            'photo2.jpg',
            'photo3.png',
            'video1.mp4',
            'photo4.jpg',
            'video2.mp4',
            // Add more filenames here...
        ];
        
        // Folder path
        const MEDIA_FOLDER = 'memories/';
        // ==============================================================

        // Image and video extensions
        const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp', 'svg'];
        const videoExtensions = ['mp4', 'webm', 'mov', 'avi', 'mkv', 'ogg'];

        // Build media items array automatically
        const mediaItems = mediaFiles.map(filename => {
            const ext = filename.split('.').pop().toLowerCase();
            const type = imageExtensions.includes(ext) ? 'image' : 
                         videoExtensions.includes(ext) ? 'video' : 'image';
            return {
                type: type,
                src: MEDIA_FOLDER + filename
            };
        });

        let currentIndex = 0;
        let touchStartX = 0;
        let touchEndX = 0;
        let isAnimating = false;

        const mediaContainer = document.getElementById('mediaContainer');
        const polaroidFrame = document.getElementById('polaroidFrame');
        const currentNum = document.getElementById('currentNum');
        const totalNum = document.getElementById('totalNum');
        const progressFill = document.getElementById('progressFill');
        const thumbnailStrip = document.getElementById('thumbnailStrip');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const heartsBurst = document.getElementById('heartsBurst');
        const confettiContainer = document.getElementById('confettiContainer');
        const bgMusic = document.getElementById('bgMusic');
        const musicIndicator = document.getElementById('musicIndicator');
        const sparkleContainer = document.getElementById('sparkleContainer');

        // Initialize
        window.addEventListener('load', () => {
            // Music handling
            const musicPlaying = localStorage.getItem('musicPlaying');
            const musicTime = localStorage.getItem('musicTime');
            
            if (musicPlaying === 'true') {
                bgMusic.currentTime = parseFloat(musicTime) || 0;
                bgMusic.play().then(() => {
                    musicIndicator.classList.add('show');
                }).catch(() => {});
            }

            // Initialize gallery
            if (mediaItems.length > 0) {
                initGallery();
                // Initial confetti burst
                setTimeout(triggerConfetti, 800);
            } else {
                showEmptyState();
            }

            // Start sparkles
            createSparkles();
            setInterval(createSparkles, 2000);
        });

        // Music indicator click
        musicIndicator.addEventListener('click', () => {
            if (bgMusic.paused) {
                bgMusic.play();
                musicIndicator.classList.remove('paused');
                localStorage.setItem('musicPlaying', 'true');
            } else {
                bgMusic.pause();
                musicIndicator.classList.add('paused');
                localStorage.setItem('musicPlaying', 'false');
            }
        });

        // Save music time periodically
        setInterval(() => {
            if (!bgMusic.paused) {
                localStorage.setItem('musicTime', bgMusic.currentTime);
            }
        }, 1000);

        function initGallery() {
            totalNum.textContent = mediaItems.length;
            createThumbnails();
            loadMedia(currentIndex, 'none');
            updateNavButtons();
            updateProgress();
        }

        function createThumbnails() {
            thumbnailStrip.innerHTML = '';
            mediaItems.forEach((item, index) => {
                const thumb = document.createElement('div');
                thumb.className = 'thumbnail' + (index === 0 ? ' active' : '');
                
                if (item.type === 'image') {
                    const img = document.createElement('img');
                    img.src = item.src;
                    img.alt = `Memory ${index + 1}`;
                    img.onerror = () => { img.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect fill="%23ddd" width="100" height="100"/><text x="50" y="55" text-anchor="middle" fill="%23999" font-size="12">?</text></svg>'; };
                    thumb.appendChild(img);
                } else {
                    const video = document.createElement('video');
                    video.src = item.src;
                    video.muted = true;
                    video.preload = 'metadata';
                    thumb.appendChild(video);
                    
                    const indicator = document.createElement('div');
                    indicator.className = 'video-indicator';
                    indicator.textContent = '‚ñ∂';
                    thumb.appendChild(indicator);
                }
                
                thumb.onclick = () => goToMedia(index);
                thumbnailStrip.appendChild(thumb);
            });
        }

        function loadMedia(index, direction) {
            if (isAnimating) return;
            isAnimating = true;

            const item = mediaItems[index];
            loadingSpinner.classList.remove('hidden');

            // Get current active media
            const currentMedia = mediaContainer.querySelector('.media-item.active');

            // Pause any playing videos
            const playingVideos = mediaContainer.querySelectorAll('video');
            playingVideos.forEach(v => v.pause());

            // Create new media element
            let newMedia;
            if (item.type === 'image') {
                newMedia = document.createElement('img');
                newMedia.src = item.src;
                newMedia.alt = `Memory ${index + 1}`;
            } else {
                newMedia = document.createElement('video');
                newMedia.src = item.src;
                newMedia.controls = true;
                newMedia.playsInline = true;
                newMedia.preload = 'auto';
            }
            
            newMedia.className = 'media-item';

            // Handle load
            const onLoad = () => {
                loadingSpinner.classList.add('hidden');

                // Animate current media out
                if (currentMedia && direction !== 'none') {
                    if (direction === 'left') {
                        currentMedia.classList.add('slide-left');
                    } else {
                        currentMedia.classList.add('slide-right');
                    }
                    setTimeout(() => currentMedia.remove(), 500);
                } else if (currentMedia) {
                    currentMedia.remove();
                }

                // Add and animate new media in
                mediaContainer.appendChild(newMedia);
                
                if (direction === 'left') {
                    newMedia.classList.add('slide-in-left');
                } else if (direction === 'right') {
                    newMedia.classList.add('slide-in-right');
                }
                
                setTimeout(() => {
                    newMedia.classList.add('active');
                    newMedia.classList.remove('slide-in-left', 'slide-in-right');
                }, 50);

                // Update UI
                currentNum.textContent = index + 1;
                updateProgress();
                updateThumbnails();
                updateNavButtons();
                tiltPolaroid(direction);

                // Trigger effects on navigation
                if (direction !== 'none') {
                    triggerHeartsBurst();
                }

                setTimeout(() => {
                    isAnimating = false;
                }, 500);
            };

            const onError = () => {
                loadingSpinner.classList.add('hidden');
                newMedia.className = 'media-item active';
                
                // Show error placeholder
                if (item.type === 'image') {
                    newMedia.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 500"><rect fill="%231a1a1a" width="400" height="500"/><text x="200" y="250" text-anchor="middle" fill="%23666" font-size="20">üì∑ Image not found</text></svg>';
                }
                
                if (currentMedia) currentMedia.remove();
                mediaContainer.appendChild(newMedia);
                
                currentNum.textContent = index + 1;
                updateProgress();
                updateThumbnails();
                updateNavButtons();
                isAnimating = false;
            };

            if (item.type === 'image') {
                newMedia.onload = onLoad;
                newMedia.onerror = onError;
            } else {
                newMedia.onloadeddata = onLoad;
                newMedia.onerror = onError;
            }
        }

        function tiltPolaroid(direction) {
            polaroidFrame.classList.remove('tilt-left', 'tilt-right');
            if (direction === 'left') {
                polaroidFrame.classList.add('tilt-right');
            } else if (direction === 'right') {
                polaroidFrame.classList.add('tilt-left');
            }
            setTimeout(() => {
                polaroidFrame.classList.remove('tilt-left', 'tilt-right');
            }, 500);
        }

        function nextMedia() {
            if (currentIndex < mediaItems.length - 1 && !isAnimating) {
                currentIndex++;
                loadMedia(currentIndex, 'left');
            }
        }

        function prevMedia() {
            if (currentIndex > 0 && !isAnimating) {
                currentIndex--;
                loadMedia(currentIndex, 'right');
            }
        }

        function goToMedia(index) {
            if (index !== currentIndex && !isAnimating) {
                const direction = index > currentIndex ? 'left' : 'right';
                currentIndex = index;
                loadMedia(currentIndex, direction);
            }
        }

        function updateNavButtons() {
            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex === mediaItems.length - 1;
        }

        function updateProgress() {
            const progress = ((currentIndex + 1) / mediaItems.length) * 100;
            progressFill.style.width = progress + '%';
        }

        function updateThumbnails() {
            const thumbs = thumbnailStrip.querySelectorAll('.thumbnail');
            thumbs.forEach((thumb, index) => {
                thumb.classList.toggle('active', index === currentIndex);
            });
            
            // Scroll active thumbnail into view
            const activeThumb = thumbs[currentIndex];
            if (activeThumb) {
                activeThumb.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
            }
        }

        function triggerHeartsBurst() {
            const hearts = ['üíï', 'üíñ', 'üíó', 'üíì', '‚ù§Ô∏è', '‚ú®', 'üå∏'];
            const rect = polaroidFrame.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            for (let i = 0; i < 10; i++) {
                const heart = document.createElement('div');
                heart.className = 'burst-heart';
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                heart.style.left = centerX + 'px';
                heart.style.top = centerY + 'px';

                const angle = (i / 10) * Math.PI * 2;
                const distance = 60 + Math.random() * 50;
                heart.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                heart.style.setProperty('--ty', Math.sin(angle) * distance + 'px');

                heartsBurst.appendChild(heart);
                setTimeout(() => heart.classList.add('animate'), 10);
                setTimeout(() => heart.remove(), 1500);
            }
        }

        function triggerConfetti() {
            const colors = ['#7BC89C', '#A8E6CF', '#FFD700', '#FF69B4', '#87CEEB', '#DDA0DD'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
                confetti.style.width = (6 + Math.random() * 8) + 'px';
                confetti.style.height = (6 + Math.random() * 8) + 'px';
                confetti.style.animationDelay = Math.random() * 1 + 's';
                confetti.style.animationDuration = (2 + Math.random() * 2) + 's';
                
                confettiContainer.appendChild(confetti);
                setTimeout(() => confetti.classList.add('fall'), 10);
                setTimeout(() => confetti.remove(), 4000);
            }
        }

        function createSparkles() {
            for (let i = 0; i < 6; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';
                    sparkle.style.left = Math.random() * 100 + '%';
                    sparkle.style.top = Math.random() * 100 + '%';
                    sparkle.style.animationDelay = Math.random() * 1 + 's';
                    sparkleContainer.appendChild(sparkle);
                    setTimeout(() => sparkle.remove(), 3000);
                }, i * 150);
            }
        }

        function showEmptyState() {
            loadingSpinner.classList.add('hidden');
            mediaContainer.innerHTML = `
                <div class="empty-state">
                    <div class="icon">üì∑</div>
                    <h3>No memories yet!</h3>
                    <p>Add your photos and videos to the<br><strong>memories</strong> folder and list them<br>in the mediaFiles array.</p>
                </div>
            `;
            totalNum.textContent = '0';
            prevBtn.disabled = true;
            nextBtn.disabled = true;
        }

        // Touch/Swipe handling
        mediaContainer.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
        }, { passive: true });

        mediaContainer.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].clientX;
            handleSwipe();
        }, { passive: true });

        function handleSwipe() {
            const diff = touchStartX - touchEndX;
            const threshold = 50;

            if (Math.abs(diff) > threshold) {
                if (diff > 0) {
                    nextMedia();
                } else {
                    prevMedia();
                }
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextMedia();
            if (e.key === 'ArrowLeft') prevMedia();
        });

        // Go back
        function goBack() {
            if (!bgMusic.paused) {
                localStorage.setItem('musicTime', bgMusic.currentTime);
                localStorage.setItem('musicPlaying', 'true');
            }

            // Pause any playing videos
            const videos = document.querySelectorAll('video');
            videos.forEach(v => v.pause());

            document.body.style.opacity = '0';
            document.body.style.transition = 'opacity 0.3s';
            setTimeout(() => {
                window.location.href = 'next-page.html';
            }, 300);
        }
    </script>
</body>
</html>
